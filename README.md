### 使用脚本前

建议先在浏览器上安装 [uBlock Origin](https://www.crxsoso.com/webstore/detail/cjpalhdlnbpafiamejdnhcphjbkeiagm) 或 [AdGuard](https://www.crxsoso.com/webstore/detail/bgnkhhnnamicmpeenaelnjfhikgbkllg) 扩展，可有效移除视频网站的视频广告。

#### 脚本菜单

![脚本菜单](./script_menu_command.png)  

### 快捷键

> `F` ：切换全屏  
> `P` ：切换网页全屏  
> `N` ：下一个视频  
> `D` ：弹幕开/关  
> `A` 或 `+` ：倍速 `+0.25`  
> `S` 或 `-` ：倍速 `-0.25 `  
> `shift` `+` / `-` ：当前倍速×÷2  
> `Z` ：恢复正常倍速   
> 数字 `0` ：快进30秒  
> 数字 `1-9` ：`1-9` 倍速  
> 空格 ：暂停/播放
> ▶ 或 `alt` `+` ：快进5秒，某些播放器覆盖失败会存在两次操作，默认▶键控制为关闭状态 
> ◀ 或 `alt` `+` ：快退5秒（同上）  
> 符号 `*` ：应用倍速到新的`video`，多视频页(如***抖音、快手网页版***)时使用。

### ~~关于自动网页全屏~~

 <b style="color:red;">最新版已可以通过脚本菜单项设置</b>

~~如果不需要打开视频播放页自动网页全屏。注释掉如下代码：~~ 

```js
const result = this.webFullScreen(video);
if (!result) return;
```

注释掉不会影响快捷键`网页全屏(P)`切换。

##### ~~自动恢复网页全屏~~ 

在视频暂停后，如重新播放且不是网页全屏，默认会恢复为网页全屏，如果不希望这样的话。注释掉如下代码：

```js
App.webFullScreen(this);
```

### 关于自动退出网页全屏

脚本默认对B站和AcFun弹幕网视频播放完自动退出全屏（番剧页不支持）。

B站视频播放完自动点击“取消连播”按钮；如果是视频合集会判断是否为最后分P或关闭了合集“自动连播”，是的话自动退出网页全屏。

如不需要该功能，可将脚本中下面注释的代码放开：

```js
// if (/[a-zA-z]+:\/\/[^\s]*/.test(href)) return;
```

### 关于倍速

使用本脚本设置了倍速，再想切换回使用网站自带的倍速设置，需要先还原为正常倍速，不然网站自带的是不起作用的。

相较于 [Greasy Fork](https://greasyfork.org/zh-CN/scripts) 上的其他视频倍速播放脚本，本脚本解决了以下问题：

1. 解决<i style="color:#00DC5A">爱奇艺</i>播放一段时间会恢复正常倍速问题。
2. 对于自动播放且视频在`<iframe>`中，不需要聚焦到视频元素上也可以设置倍速。
3. 多视频页面如**抖音网页版**，切换新视频时，如果鼠标有悬停在视频上方自动应用记忆倍速，没有悬停的话，可以使用`*`快捷键应用记忆倍速。

本脚本的倍速设置<b style="color:red;">默认是不匹配所有网页的</b>。

需要的话可将脚本中的：

```js
// @note        *://*/*
```

改成：

```js
// @match        *://*/*
```

或只对特定网站`@match`，如**百度网盘**：

```js
// @match        *://pan.baidu.com/*
```

~~默认倍速步进为`±0.25`，不满足需求？~~ <b style="color:red;">最新版可以通过脚本菜单项设置</b>

```js
// 修改为喜欢的
PLAY_RATE_STEP: 0.25
```

默认倍速提示时长5秒，觉得太久？

```js
// 修改为喜欢的
SHOW_TOAST_TIME: ONE_SECOND * 5
```

默认倍速提示处于视频的左下方，可选居中提示。

```js
// 修改为居中提示
SHOW_TOAST_POSITION: positions.center
```

#### 网站适配性

本脚本<b style="color:red;">理论上</b>对所有网页，有`video`标签都能够进行倍速播放。某些网站会限定最高倍速。

### 其他功能

脚本实现了页面可见性监听，当视频播放标签页不可见时会暂停播放，可见时继续播放。

如不需要该功能的话，把下面的代码注释掉：

```js
this.setupVisibleListener();
```

### 自定义快捷键功能

懒得滑动鼠标，想实现对网页上的某个元素通过快捷键点击？

#### 示例

如对**B站**定义`字幕开关(T)`快捷键。

配置`selectorConfig`：

```js
const selectorConfig = {
    "www.bilibili.com": {
        subtitle: ".bpx-player-ctrl-subtitle .bpx-common-svg-icon", // 新增的自定义快捷键有效点击元素
    }
}
```

找到**`execHotKeyActions`**方法，在`actions`中新增：

```js
const actions = {
    T: () => clickElement("subtitle"), // 新增的自定义快捷键，"subtitle"为selectorConfig配置的key值
};
```

### 实验性扩展功能

使用 [视频网页全屏（改）](https://greasyfork.org/zh-CN/scripts/495077-maximize-video-improve)  脚本时，需要鼠标悬停到视频上方，才可以按`esc`键进行网页全屏。

使用本脚本可以按 `P` 键直接网页全屏，无需滑动鼠标，对某些自动播放页可以减少操作。  某些页面网页全屏后，按 `P` 键不能退出全屏，需要使用 [视频网页全屏（改）](https://greasyfork.org/zh-CN/scripts/495077-maximize-video-improve) 的 `esc` 退出。

<b style="color:red;">不保证100%有效</b>。

使用前需把：

```js
// @note        *://*/*
```

改成：

```js
// @match        *://*/*
```

针对特定页面，不能使用 `@match`，需要使用 `@include`，如 [嗷呜动漫](https://www.aowu.tv)：

```
// @include      *://www.aowu.tv/play*
```

### 更新历史

- 2.6.0
  1. 修复倍速提示精度问题。
  2. 实验性扩展功能优化，提高准确性。
  3. 新增：脚本菜单设置开/关自动网页全屏、设置倍速步进、快进/快退时长。
  4. 新增：快进(▶ 或 `alt` `+`)、快退(◀ 或 `alt` `-`)、暂停/播放(空格)快捷键，在 `iframe` 页不需要聚焦到播放器也可以控制（非自动播放，空格键控制，需要点击播放后才可以）。
  5. 多视频页增加定时监测机制，不断检查当前当前播放的`video`，实时应用倍速到新的视频。
  
- 2.5.1
  1. 适配斗鱼视频（v.douyu.com）。
  
- 2.4.8
  
  1. 新增：数字 `0` 快捷键，快进30秒。
  
- 2.4.6
  
  1. 优化播放结束退出网页全屏的代码。
  
- 2.4.5
  
  1. B站：优化视频播放可见性监听，已播放结束的视频不再播放。
  
- 2.4.4
  1. fiX：B站嵌套直播间网页全屏导航栏不消失问题。
  
- 2.4.3
  1. 自动关闭腾讯视频播放页的登录弹窗。
  2. 隐藏B站播放内的各类弹窗，如：一键三连、左下角的登录提示。
  3. 优化B站播放1分钟的登录弹窗。
  
- 2.4.0
  1. 自动关闭B站未登录状态下观看视频1分钟时的登录弹窗。
  
- v 2.3.0
  1. 新增`shift` `+` / `-` 快捷键，当前倍速×÷2，便于设置最高倍速。
  
- v 2.2.0
  1. 移除 `0` 快捷键。
  2. fix: B站直播可见性监听失效问题。
  
- v 2.1.0
  1. bug: 移除在`@match`中的地址鼠标悬停监听，该监听会影响腾讯视频的倍速播放。
  2. fix：**抖音网页版**为直播间时也会应用倍速问题。
  3. 新增对 [视频网页全屏（改）](https://greasyfork.org/zh-CN/scripts/495077-maximize-video-improve)  的实验性扩展。
  
- v 2.0.0
  1. 新增倍速播放功能。
  2. 新增页面可见性监听，当视频播放标签页不可见时会暂停播放，可见时继续播放。
  
- v 0.9.9
  1. 解决B站直播不支持`全屏切换`、`关闭弹幕`快捷键。
  
- v 0.9.7
  1. 新增`全屏(F)`、`网页全屏(P)`、`下一个视频(N)`、`弹幕开关(D)`快捷键。